{% extends 'base.html.twig' %}

{% block step_description %}{% trans %}Create configuration file{% endtrans %}{% endblock %}

{% block content %}
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-secondary text-white">
            {% trans %}Step{% endtrans %} {{ current_step }}: {% trans %}Create configuration file{% endtrans %}
        </div>
        <div class="card-body">
            <div class="alert alert-success py-1 mb-2 small">
                <strong>{% trans %}Configuration File:{% endtrans %}</strong> {% trans %}Create the file {% endtrans %}
                <em>config/settings.php</em>
                {% trans %} with the following content:{% endtrans %}
            </div>

            <div class="p-2 bg-light rounded position-relative">
                <button id="copy-config" class="btn btn-sm btn-secondary position-absolute top-0 end-0 m-2">
                    <i class="bi bi-clipboard"></i> Copy
                </button>
                <pre id="config-content" class="bg-dark text-light p-2 rounded small" style="font-size: 0.75rem;">
&lt;?php

/**
 * Poweradmin Settings Configuration File
 *
 * Generated by the installer on {{ "now"|date("Y-m-d H:i:s") }}
 */

return [
    /**
     * Database Settings
     */
    'database' => [
{% if db_file %}
        'type' => '{{ db_type }}',
        'file' => '{{ db_name }}',
{% else %}
        'host' => '{{ db_host }}',
        'name' => '{{ db_name }}',
        'user' => '{{ db_user }}',
        'password' => '{{ db_pass }}',
        'type' => '{{ db_type }}',
{% if db_port %}
        'port' => '{{ db_port }}',
{% endif %}
{% if db_charset %}
        'charset' => '{{ db_charset }}',
{% endif %}
{% if pdns_db_name is defined and pdns_db_name is not empty %}
        'pdns_db_name' => '{{ pdns_db_name }}',
{% endif %}
{% endif %}
    ],

    /**
     * Security Settings
     */
    'security' => [
        'session_key' => '{{ session_key }}',
    ],

    /**
     * Interface Settings
     */
    'interface' => [
        'language' => '{{ language }}',
    ],

    /**
     * DNS Settings
     */
    'dns' => [
        'hostmaster' => '{{ dns_hostmaster }}',
        'ns1' => '{{ dns_ns1 }}',
        'ns2' => '{{ dns_ns2 }}',
{% if dns_ns3 is defined and dns_ns3 is not empty %}
        'ns3' => '{{ dns_ns3 }}',
{% endif %}
{% if dns_ns4 is defined and dns_ns4 is not empty %}
        'ns4' => '{{ dns_ns4 }}',
{% endif %}
    ]
];
</pre>
            </div>
            
            <script>
                document.getElementById('copy-config').addEventListener('click', function() {
                    const content = document.getElementById('config-content').textContent;
                    navigator.clipboard.writeText(content).then(function() {
                        const btn = document.getElementById('copy-config');
                        btn.innerHTML = '<i class="bi bi-check-lg"></i> Copied!';
                        setTimeout(function() {
                            btn.innerHTML = '<i class="bi bi-clipboard"></i> Copy';
                        }, 2000);
                    });
                });
            </script>

            <form method="post" class="mt-3">
                <input type="hidden" name="install_token" value="{{ install_token }}">
                <input type="hidden" name="step" value="{{ next_step }}">
                <input type="hidden" name="language" value="{{ language }}">
                <div class="mt-4 text-center">
                    <input type="submit" name="submit" class="btn btn-sm btn-primary"
                           value="{% trans %}Continue to step{% endtrans %} {{ next_step }}">
                </div>
            </form>
        </div>
    </div>
{% endblock %}